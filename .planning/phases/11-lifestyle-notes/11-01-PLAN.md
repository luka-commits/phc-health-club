---
phase: 11-lifestyle-notes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/002_lifestyle_notes.sql
  - src/types/database.ts
autonomous: true
---

<objective>
Create database tables for lifestyle notes and body metrics tracking with proper RLS policies.

Purpose: Foundation for patient self-tracking features â€” lifestyle notes and body measurements need secure storage with patient-only access.
Output: Migration file with tables and RLS, updated TypeScript types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-lifestyle-notes/11-CONTEXT.md

@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create migration for lifestyle_notes and body_metrics tables</name>
  <files>supabase/migrations/002_lifestyle_notes.sql</files>
  <action>
Create SQL migration with two tables:

**lifestyle_notes table:**
- id: uuid primary key default gen_random_uuid()
- patient_id: uuid references patients(id) on delete cascade
- content: text not null (freeform note text)
- note_date: date not null (date the note is about)
- created_at: timestamptz default now()
- updated_at: timestamptz default now()

**body_metrics table:**
- id: uuid primary key default gen_random_uuid()
- patient_id: uuid references patients(id) on delete cascade
- measured_at: date not null
- weight_lbs: decimal(5,1) null (weight in pounds, one decimal)
- chest_inches: decimal(4,1) null
- waist_inches: decimal(4,1) null
- hip_inches: decimal(4,1) null
- arm_inches: decimal(4,1) null (bicep measurement)
- thigh_inches: decimal(4,1) null
- notes: text null
- created_at: timestamptz default now()

**RLS Policies (same pattern as blood_work):**
- Enable RLS on both tables
- Patients can SELECT, INSERT, UPDATE, DELETE their own records (patient_id matches their patients.id via user_id join)
- Providers can SELECT patient records they're assigned to

**Indexes:**
- lifestyle_notes: (patient_id, note_date DESC)
- body_metrics: (patient_id, measured_at DESC)
  </action>
  <verify>Check migration file syntax is valid SQL</verify>
  <done>Migration file exists with both tables, RLS policies, and indexes</done>
</task>

<task type="auto">
  <name>Task 2: Add TypeScript types for lifestyle notes and body metrics</name>
  <files>src/types/database.ts</files>
  <action>
Add interfaces after existing types:

```typescript
export interface LifestyleNote {
  id: string;
  patient_id: string;
  content: string;
  note_date: string;
  created_at: string;
  updated_at: string;
}

export interface BodyMetric {
  id: string;
  patient_id: string;
  measured_at: string;
  weight_lbs: number | null;
  chest_inches: number | null;
  waist_inches: number | null;
  hip_inches: number | null;
  arm_inches: number | null;
  thigh_inches: number | null;
  notes: string | null;
  created_at: string;
}
```

Place after the AuditLog interface but before the extended types section.
  </action>
  <verify>TypeScript compilation succeeds: npx tsc --noEmit</verify>
  <done>LifestyleNote and BodyMetric interfaces exported from database.ts</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Migration file has valid SQL syntax
- [ ] Both tables have proper foreign keys and RLS
- [ ] TypeScript types match migration schema
- [ ] `npx tsc --noEmit` passes
</verification>

<success_criteria>

- Migration file created at supabase/migrations/002_lifestyle_notes.sql
- lifestyle_notes and body_metrics tables defined with RLS
- TypeScript interfaces added to database.ts
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-lifestyle-notes/11-01-SUMMARY.md`
</output>
