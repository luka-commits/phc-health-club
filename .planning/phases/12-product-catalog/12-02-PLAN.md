---
phase: 12-product-catalog
plan: 02
type: execute
wave: 2
depends_on: [12-01]
files_modified:
  - supabase/migrations/003_product_goals.sql
  - src/types/database.ts
  - src/app/(dashboard)/patient/products/page.tsx
  - src/app/(dashboard)/patient/products/[id]/page.tsx
autonomous: true
---

<objective>
Add goal-based product filtering and peptide dosing disclaimers.

Purpose: Enable patients to find products by health goals and ensure proper disclaimers are shown for peptide dosing information.
Output: Goal filter tabs/chips on product catalog, disclaimer text on peptide products.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@src/app/(dashboard)/patient/products/page.tsx
@src/app/(dashboard)/patient/products/[id]/page.tsx
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add goals column to products table</name>
  <files>supabase/migrations/003_product_goals.sql</files>
  <action>
Create a migration to add goals support to the products table.

Implementation:
1. Create new migration file 003_product_goals.sql
2. Add `goals` column as TEXT[] (array of strings) with default empty array
3. Goals should be one or more of: 'muscle_building', 'fat_loss', 'energy', 'cognitive', 'skin', 'hair', 'libido'
4. No enum needed - use check constraint or leave flexible for future goal additions
5. Add a comment explaining the valid goal values

SQL:
```sql
-- Add goals column to products table
-- Valid goals: muscle_building, fat_loss, energy, cognitive, skin, hair, libido
ALTER TABLE products
ADD COLUMN goals TEXT[] NOT NULL DEFAULT '{}';

-- Add index for goal-based queries
CREATE INDEX idx_products_goals ON products USING GIN (goals);
```
  </action>
  <verify>
- Migration file exists with correct SQL
- Goals column will be added as TEXT array
  </verify>
  <done>Migration file created for adding goals column to products table</done>
</task>

<task type="auto">
  <name>Task 2: Update Product type with goals field</name>
  <files>src/types/database.ts</files>
  <action>
Update the Product interface to include the goals field.

Implementation:
1. Add ProductGoal type: 'muscle_building' | 'fat_loss' | 'energy' | 'cognitive' | 'skin' | 'hair' | 'libido'
2. Add goals: ProductGoal[] to the Product interface
  </action>
  <verify>
- ProductGoal type is exported
- Product interface includes goals field
- TypeScript compiles without errors
  </verify>
  <done>Product type updated with goals field and ProductGoal type</done>
</task>

<task type="auto">
  <name>Task 3: Add goal filter to products page</name>
  <files>src/app/(dashboard)/patient/products/page.tsx</files>
  <action>
Add goal-based filtering as horizontal scrollable chips below the search bar.

Implementation:
1. Add goal labels mapping:
   - muscle_building: "Muscle Building" (Dumbbell icon)
   - fat_loss: "Fat Loss" (Flame icon)
   - energy: "Energy" (Zap icon)
   - cognitive: "Cognitive" (Brain icon)
   - skin: "Skin" (Sparkles icon)
   - hair: "Hair" (Scissors icon or similar)
   - libido: "Libido" (Heart icon)
2. Add a row of clickable Badge components (chips) for each goal
3. Allow multiple goal selection (toggle behavior)
4. Filter products to show only those matching ANY selected goal (OR logic)
5. If no goals selected, show all products
6. Goals filter should work in combination with:
   - Search filter (applied first)
   - Type tabs (applied after)
7. Show goal badges on product cards for products that have goals
8. Use horizontal ScrollArea for goal chips on mobile

Layout: Goals row between search input and tabs, with "Filter by goal:" label
  </action>
  <verify>
- Goal filter chips render correctly
- Clicking a goal chip toggles its selection state
- Products filter correctly by selected goals
- Multiple goals can be selected
- Filtering works with search and type tabs
  </verify>
  <done>Products page has goal-based filtering with clickable goal chips</done>
</task>

<task type="auto">
  <name>Task 4: Add peptide dosing disclaimer</name>
  <files>src/app/(dashboard)/patient/products/page.tsx, src/app/(dashboard)/patient/products/[id]/page.tsx</files>
  <action>
Add "For educational purposes only" disclaimer for peptide dosing information.

Implementation for product cards (page.tsx):
1. In the ProductCard component, when displaying dosing_info for peptide products:
2. Add italic disclaimer text below dosing info: "For educational purposes only"
3. Use text-xs and text-muted-foreground styling

Implementation for product detail page ([id]/page.tsx):
1. When displaying dosing information for peptide products:
2. Add an Alert component (variant="default") with Info icon
3. Alert content: "Dosing information is provided for educational purposes only. Always consult with your healthcare provider before starting any peptide therapy."
4. Place alert directly below the dosing information card

Styling: Disclaimer should be clearly visible but not overly prominent
  </action>
  <verify>
- Peptide products show disclaimer on cards
- Peptide product detail page shows Alert disclaimer
- Non-peptide products do not show disclaimer
- Disclaimer text is clearly readable
  </verify>
  <done>Peptide dosing sections show educational purposes disclaimer</done>
</task>

<task type="auto">
  <name>Task 5: Show goals on product detail page</name>
  <files>src/app/(dashboard)/patient/products/[id]/page.tsx</files>
  <action>
Display product goals on the detail page.

Implementation:
1. Add a "Health Goals" section if product has goals
2. Display goals as colored Badge components
3. Use same icons/colors as the filter chips for consistency
4. Place section between product description and dosing info
5. If no goals, don't show the section

Layout: "Health Goals" label with horizontal row of goal badges
  </action>
  <verify>
- Products with goals show the Health Goals section
- Goals display with correct icons and labels
- Products without goals don't show the section
  </verify>
  <done>Product detail page displays health goals with badges</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Migration file created
- [ ] Product type updated
- [ ] Goal filter works on products page
- [ ] Peptide disclaimer shows on cards and detail page
- [ ] Goals display on product detail page
- [ ] `npm run build` succeeds without errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Goal filtering works in combination with search and type filters
- Peptide disclaimers are visible and appropriate
</success_criteria>

<output>
After completion, create `.planning/phases/12-product-catalog/12-02-SUMMARY.md`
</output>
