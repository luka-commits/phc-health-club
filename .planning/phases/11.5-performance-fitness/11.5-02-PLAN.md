---
phase: 11.5-performance-fitness
plan: 02
type: execute
wave: 2
depends_on: ["11.5-01"]
files_modified:
  - src/lib/actions/personal-records.ts
  - src/lib/actions/fitness-notes.ts
  - src/components/fitness/PRChart.tsx
  - src/app/(dashboard)/patient/fitness/page.tsx
  - src/app/(dashboard)/patient/fitness/add-pr-form.tsx
  - src/app/(dashboard)/patient/fitness/pr-chart-section.tsx
  - src/app/(dashboard)/patient/fitness/fitness-notes-section.tsx
  - src/app/(dashboard)/patient/fitness/add-note-form.tsx
autonomous: true
---

<objective>
Build the Performance & Fitness page with PR tracking, strength progress charts, and fitness notes.

Purpose: Allow patients to log gym PRs, view strength progress over time, and keep a training log.
Output: Fully functional /patient/fitness page with forms, charts, and notes list.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11.5-performance-fitness/CONTEXT.md
@.planning/phases/11.5-performance-fitness/11.5-01-SUMMARY.md
@.planning/phases/11-lifestyle-notes/11-03-SUMMARY.md

# Key patterns to follow:
@src/lib/actions/body-metrics.ts
@src/components/body-metrics/BodyMetricsChart.tsx
@src/app/(dashboard)/patient/body-metrics/page.tsx
@src/app/(dashboard)/patient/body-metrics/add-metric-form.tsx
@src/app/(dashboard)/patient/body-metrics/metrics-chart-section.tsx
@src/app/(dashboard)/patient/lifestyle/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create server actions for PRs and fitness notes</name>
  <files>src/lib/actions/personal-records.ts, src/lib/actions/fitness-notes.ts</files>
  <action>
Create server actions following body-metrics.ts pattern:

**personal-records.ts:**
- `createPersonalRecord(input)`: Create PR with lift_type, weight_lbs, reps, recorded_at, notes
- `getPersonalRecords()`: Get all PRs for patient (limit 100, ordered by recorded_at DESC)
- `getPersonalRecordsByLift(liftType)`: Get PRs for specific lift (for chart filtering)
- `getCurrentPRs()`: Get best PR per lift type (MAX weight for given reps, or 1RM equivalent)

**fitness-notes.ts:**
- `createFitnessNote(input)`: Create note with content, note_date
- `getFitnessNotes()`: Get all notes (limit 50, ordered by note_date DESC)

Follow ActionResult pattern: `{ success: true, data? } | { success: false, error }`
Validate user is authenticated patient before operations.
Use revalidatePath('/patient/fitness') after mutations.
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>Server actions for PRs and fitness notes created and type-safe</done>
</task>

<task type="auto">
  <name>Task 2: Create PR chart component and chart section</name>
  <files>src/components/fitness/PRChart.tsx, src/app/(dashboard)/patient/fitness/pr-chart-section.tsx</files>
  <action>
**PRChart.tsx** (similar to BodyMetricsChart):
- Client component with Recharts LineChart
- Props: data (PersonalRecord[]), liftType (LiftType)
- X-axis: recorded_at date
- Y-axis: weight_lbs
- Show reps as tooltip info
- Use shadcn ChartContainer pattern

**pr-chart-section.tsx**:
- Client component with tabs for each lift type
- Tabs: Squat, Bench Press, Deadlift, Overhead Press, Row, Pull-up
- Each tab shows PRChart filtered to that lift
- Show "No data yet" message if no PRs for selected lift
  </action>
  <verify>npm run build succeeds</verify>
  <done>PR chart component renders lift progress over time with tab switching</done>
</task>

<task type="auto">
  <name>Task 3: Build fitness page with PR form, charts, and notes</name>
  <files>src/app/(dashboard)/patient/fitness/page.tsx, src/app/(dashboard)/patient/fitness/add-pr-form.tsx, src/app/(dashboard)/patient/fitness/fitness-notes-section.tsx, src/app/(dashboard)/patient/fitness/add-note-form.tsx</files>
  <action>
**page.tsx** (server component):
- Fetch current PRs and fitness notes via server actions
- Layout with two main sections:
  1. PR Tracking section (top): Current PRs display + Add PR form + Chart section
  2. Training Log section (bottom): Notes list + Add note form
- Pass data to client components via props

**add-pr-form.tsx** (client component):
- Form with: lift_type (select), weight (number), reps (number), date, notes (optional textarea)
- Lift type options: Squat, Bench Press, Deadlift, Overhead Press, Barbell Row, Pull-up, Other
- Submit calls createPersonalRecord action
- Show success/error toast

**fitness-notes-section.tsx** (client component):
- Display notes list similar to lifestyle notes
- Each note shows: date, content
- Sorted by date descending

**add-note-form.tsx** (client component):
- Simple form: date picker + textarea for content
- Submit calls createFitnessNote action
- Show success/error toast
  </action>
  <verify>Navigate to /patient/fitness - page renders without errors, forms work</verify>
  <done>Fitness page displays PRs, charts, and notes with working forms</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] /patient/fitness page loads without errors
- [ ] Can add a new PR via form
- [ ] PR chart displays data with tab switching
- [ ] Can add fitness notes via form
- [ ] Notes list displays entries
</verification>

<success_criteria>

- All tasks completed
- Server actions work for PRs and notes
- PR charts render with lift type tabs
- Forms submit successfully with toast feedback
- Page follows same patterns as body-metrics
  </success_criteria>

<output>
After completion, create `.planning/phases/11.5-performance-fitness/11.5-02-SUMMARY.md`
</output>
