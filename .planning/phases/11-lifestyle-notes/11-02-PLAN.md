---
phase: 11-lifestyle-notes
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/lib/actions/lifestyle.ts
  - src/app/(dashboard)/patient/lifestyle/page.tsx
autonomous: true
---

<objective>
Build the Lifestyle Notes page where patients can write freeform notes and view provider meeting notes.

Purpose: Patients need a space to journal their health journey and see what providers documented during appointments.
Output: Lifestyle notes page with add form, note list, and provider meeting notes section.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-lifestyle-notes/11-CONTEXT.md

@src/types/database.ts
@src/lib/actions/blood-work.ts
@src/app/(dashboard)/patient/blood-work/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create lifestyle server actions</name>
  <files>src/lib/actions/lifestyle.ts</files>
  <action>
Create server actions following the ActionResult pattern from blood-work.ts:

**createLifestyleNote(input: { content: string; noteDate: string })**
- Validate user is authenticated and is a patient
- Get patient.id from user_id
- Insert into lifestyle_notes
- revalidatePath('/patient/lifestyle')
- Return ActionResult

**getLifestyleNotes()**
- Returns ActionResult<LifestyleNote[]>
- Query lifestyle_notes for current patient
- Order by note_date DESC, created_at DESC
- Used by page component

**getProviderMeetingNotes()**
- Returns ActionResult<{ date: string; notes: string; providerName: string }[]>
- Query appointments where patient_id matches and notes is not null
- Join with providers and users to get provider name
- Order by datetime DESC
- Only return completed appointments with notes
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>Three server actions exported: createLifestyleNote, getLifestyleNotes, getProviderMeetingNotes</done>
</task>

<task type="auto">
  <name>Task 2: Create lifestyle notes page with form and lists</name>
  <files>src/app/(dashboard)/patient/lifestyle/page.tsx</files>
  <action>
Create page component following blood-work page patterns:

**Layout:**
- PageHeader with title "Lifestyle Notes" and description
- Two sections side by side on desktop (grid), stacked on mobile

**Left section - My Notes:**
- Card with "Add Note" form at top:
  - Date picker (default today)
  - Textarea for content
  - Submit button
- List of existing notes below, newest first
- Each note shows: date, content preview, expand/collapse
- EmptyState if no notes

**Right section - Provider Meeting Notes:**
- Card showing notes from appointments
- Read-only display
- Each entry: date, provider name, notes content
- EmptyState with message "Notes from your provider meetings will appear here"

**Client component for form:**
- Use "use client" for form interactivity
- Call createLifestyleNote server action on submit
- Use useTransition for pending state
- Show toast on success/error using sonner

Follow the existing styling patterns with Card, CardHeader, CardContent from shadcn/ui.
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>Lifestyle page accessible at /patient/lifestyle with functioning add form and both note sections</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Server actions handle auth and validation
- [ ] Page renders without errors
- [ ] Add note form submits and saves to database
- [ ] Provider meeting notes section displays (even if empty)
- [ ] `npm run build` succeeds
</verification>

<success_criteria>

- Server actions created in src/lib/actions/lifestyle.ts
- Lifestyle page created at /patient/lifestyle
- Patients can add freeform notes with date
- Provider meeting notes displayed read-only
- No build errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-lifestyle-notes/11-02-SUMMARY.md`
</output>
