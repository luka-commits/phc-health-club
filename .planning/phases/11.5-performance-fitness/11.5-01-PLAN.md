---
phase: 11.5-performance-fitness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/004_performance_fitness.sql
  - src/types/database.ts
autonomous: true
---

<objective>
Create database schema for performance & fitness tracking: personal records (PRs), fitness notes, and nutrition logs.

Purpose: Establish data layer for patient gym tracking features, following same patterns as Phase 11 (lifestyle_notes, body_metrics).
Output: Migration file with 3 tables + RLS policies, TypeScript interfaces.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11.5-performance-fitness/CONTEXT.md
@.planning/phases/11-lifestyle-notes/11-01-SUMMARY.md

# Key patterns from Phase 11:
@supabase/migrations/003_lifestyle_notes.sql
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create migration for performance & fitness tables</name>
  <files>supabase/migrations/004_performance_fitness.sql</files>
  <action>
Create migration with 3 tables following Phase 11 patterns:

1. **personal_records** table:
   - id: uuid primary key
   - patient_id: uuid FK to patients
   - lift_type: text (squat, bench_press, deadlift, overhead_press, row, pull_up, etc.)
   - weight_lbs: numeric for weight lifted
   - reps: integer for rep count
   - recorded_at: date for when PR was set
   - notes: text nullable
   - created_at, updated_at timestamps

2. **fitness_notes** table:
   - id: uuid primary key
   - patient_id: uuid FK to patients
   - content: text for freeform training log
   - note_date: date
   - created_at, updated_at timestamps

3. **nutrition_logs** table (basic MVP):
   - id: uuid primary key
   - patient_id: uuid FK to patients
   - log_date: date
   - calories: integer nullable
   - protein_g: integer nullable
   - carbs_g: integer nullable
   - fats_g: integer nullable
   - notes: text nullable
   - created_at, updated_at timestamps

RLS policies (same pattern as body_metrics):
- Patients: Full CRUD on own records
- Providers: SELECT on assigned patients via treatment_plans join

Indexes:
- (patient_id, recorded_at DESC) on personal_records
- (patient_id, lift_type, recorded_at DESC) on personal_records for lift-specific queries
- (patient_id, note_date DESC) on fitness_notes
- (patient_id, log_date DESC) on nutrition_logs

Add updated_at trigger for all 3 tables.
  </action>
  <verify>Check migration file exists and has valid SQL syntax</verify>
  <done>Migration 004 creates personal_records, fitness_notes, nutrition_logs tables with RLS</done>
</task>

<task type="auto">
  <name>Task 2: Add TypeScript types for performance & fitness</name>
  <files>src/types/database.ts</files>
  <action>
Add interfaces to src/types/database.ts matching the migration schema:

```typescript
export type LiftType = 'squat' | 'bench_press' | 'deadlift' | 'overhead_press' | 'barbell_row' | 'pull_up' | 'other';

export interface PersonalRecord {
  id: string;
  patient_id: string;
  lift_type: LiftType;
  weight_lbs: number;
  reps: number;
  recorded_at: string;
  notes: string | null;
  created_at: string;
  updated_at: string;
}

export interface FitnessNote {
  id: string;
  patient_id: string;
  content: string;
  note_date: string;
  created_at: string;
  updated_at: string;
}

export interface NutritionLog {
  id: string;
  patient_id: string;
  log_date: string;
  calories: number | null;
  protein_g: number | null;
  carbs_g: number | null;
  fats_g: number | null;
  notes: string | null;
  created_at: string;
  updated_at: string;
}
```

Add these after the existing BodyMetric interface.
  </action>
  <verify>TypeScript compiles: npx tsc --noEmit</verify>
  <done>PersonalRecord, FitnessNote, NutritionLog types exported from database.ts</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Migration file exists at supabase/migrations/004_performance_fitness.sql
- [ ] All 3 tables defined with proper columns and RLS
- [ ] TypeScript types added and compile without errors
- [ ] npm run build succeeds
</verification>

<success_criteria>

- All tasks completed
- Migration file created with 3 tables, RLS policies, indexes
- TypeScript interfaces match schema
- Build passes
  </success_criteria>

<output>
After completion, create `.planning/phases/11.5-performance-fitness/11.5-01-SUMMARY.md`
</output>
