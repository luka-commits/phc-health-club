---
phase: 16-patient-detail-view
plan: 04
type: execute
wave: 2
depends_on: ["16-01"]
files_modified:
  - src/app/(dashboard)/provider/patients/[id]/page.tsx
  - src/components/provider/patient-detail/lifestyle-tab.tsx
  - src/components/provider/patient-detail/intake-form-display.tsx
autonomous: true
---

<objective>
Add Lifestyle & Notes tab with patient lifestyle notes, body metrics, and intake form data.

Purpose: Provider can view what patient has written, their body metrics progress, and intake form responses.
Output: Lifestyle tab displays patient's notes, metrics charts, and intake form data in organized sections.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan context
@.planning/phases/16-patient-detail-view/16-01-SUMMARY.md

# Existing lifestyle patterns
@src/app/(dashboard)/patient/lifestyle/page.tsx
@src/app/(dashboard)/patient/body-metrics/page.tsx
@src/lib/actions/lifestyle.ts
@src/types/database.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LifestyleTab component</name>
  <files>src/components/provider/patient-detail/lifestyle-tab.tsx</files>
  <action>
Create component displaying patient's lifestyle data (provider read-only view):

1. Props:
   - lifestyleNotes: LifestyleNote[]
   - bodyMetrics: BodyMetric[]
   - fitnessNotes: FitnessNote[] (optional)
   - personalRecords: PersonalRecord[] (optional)

2. Layout (3 sections in grid):

   a. Patient Notes Section (Card):
      - Title: "Patient's Lifestyle Notes"
      - Description: "Notes written by the patient about their health journey"
      - List of notes with date and content
      - Scrollable if many notes (max-height with ScrollArea)
      - Empty state if no notes

   b. Body Metrics Section (Card):
      - Title: "Body Measurements"
      - Most recent measurements displayed
      - Mini trend chart for weight (last 5 readings)
      - List showing: weight, chest, waist, hip, arm, thigh
      - Empty state if no metrics

   c. Fitness Progress Section (Card):
      - Title: "Fitness & Performance"
      - Latest PRs by lift type
      - Recent fitness notes (last 3)
      - Empty state if no fitness data

All sections are READ-ONLY for provider (no edit buttons).
Use existing component patterns but simplified for provider view.
  </action>
  <verify>Component displays all lifestyle data sections correctly</verify>
  <done>LifestyleTab shows patient notes, metrics, and fitness data</done>
</task>

<task type="auto">
  <name>Task 2: Create IntakeFormDisplay component</name>
  <files>src/components/provider/patient-detail/intake-form-display.tsx</files>
  <action>
Create component to display intake form responses:

1. Props:
   - intakeData: Record<string, unknown> | null
   - intakeCompleted: boolean

2. If not completed:
   - Show Alert with info variant
   - "Intake form not completed"
   - Show intake status badge

3. If completed, display intake form data:
   - Parse JSON structure intelligently
   - Group by sections if structured that way
   - Display each field as label: value pairs
   - Handle different value types:
     - Strings: display directly
     - Booleans: Yes/No badges
     - Arrays: comma-separated or bulleted list
     - Nested objects: indented subsections
   - Format dates if detected

4. Common intake form fields to look for:
   - Medical history
   - Current medications
   - Allergies
   - Goals
   - Previous treatments
   - Lifestyle factors

Use Accordion for collapsible sections if data is extensive.
Format keys nicely (snake_case to Title Case).
  </action>
  <verify>Component renders intake form data in readable format</verify>
  <done>IntakeFormDisplay shows all intake responses organized by section</done>
</task>

<task type="auto">
  <name>Task 3: Integrate lifestyle tab into detail page</name>
  <files>src/app/(dashboard)/provider/patients/[id]/page.tsx</files>
  <action>
Update the patient detail page to:

1. Fetch lifestyle data in server component:
   - Query lifestyle_notes for patient (order by note_date desc)
   - Query body_metrics for patient (order by measured_at desc)
   - Query personal_records for patient (order by recorded_at desc)
   - Query fitness_notes for patient (order by note_date desc)
   - Already have intake_form_data and intake_completed from patient

2. Update "Lifestyle & Notes" TabsContent:
   - Two-row layout:
     - Top: LifestyleTab with notes, metrics, fitness
     - Bottom: IntakeFormDisplay with intake form data
   - Proper spacing between sections

3. Remove placeholder text from Lifestyle & Notes tab

4. Ensure all data passed as props (server-fetched)

This tab is read-only - provider views but doesn't edit patient's personal notes.
  </action>
  <verify>Lifestyle tab shows all patient data correctly</verify>
  <done>Lifestyle & Notes tab fully functional with all sections</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Lifestyle tab displays patient's notes
- [ ] Body metrics show with mini chart
- [ ] Fitness/PR data displays if available
- [ ] Intake form data rendered in readable format
- [ ] All sections are read-only (no edit buttons)
- [ ] Empty states handle missing data
- [ ] Scrollable areas work for long content
</verification>

<success_criteria>
- Provider can view all patient lifestyle notes
- Body metrics displayed with trends
- Fitness progress visible
- Intake form responses readable
- No edit capability (view only)
</success_criteria>

<output>
After completion, create `.planning/phases/16-patient-detail-view/16-04-SUMMARY.md`
</output>
